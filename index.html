
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inspection CRM with Login and Roles</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { color: #333; }
        .hidden { display: none; }
        nav a { margin: 0 10px; cursor: pointer; }
        .tabcontent { margin-top: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        .button { cursor: pointer; padding: 6px 12px; background-color: #007BFF; color: white; border: none; border-radius: 4px; }
        .button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<h1>Inspection CRM - Login</h1>
<div id="loginScreen">
    <label>Email: <input type="email" id="email" /></label><br /><br />
    <label>Password: <input type="password" id="password" /></label><br /><br />
    <button class="button" onclick="login()">Login</button>
    <p><a href="#" onclick="showResetPassword()">Forgot Password?</a></p>
    <div id="loginMessage" style="color:red; margin-top:10px;"></div>
</div>

<div id="resetPasswordScreen" class="hidden">
    <h2>Reset Password</h2>
    <label>Email: <input type="email" id="resetEmail" /></label><br /><br />
    <button class="button" onclick="resetPassword()">Reset</button>
    <button class="button" onclick="showLogin()">Back to Login</button>
    <div id="resetMessage" style="color:green; margin-top:10px;"></div>
</div>

<div id="app" class="hidden">
    <p>Welcome, <span id="userEmail"></span> (<span id="userRole"></span>)</p>
    <nav>
        <a href="#" onclick="showTab('dashboard')">Dashboard</a> |
        <a href="#" onclick="showTab('customers')">Customers</a> |
        <a href="#" onclick="showTab('inspections')">Inspections</a> |
        <a href="#" onclick="showTab('proposals')">Proposals</a> |
        <a href="#" onclick="showTab('technicians')">Technicians</a> |
        <a href="#" onclick="showTab('reports')">Reports</a> |
        <a href="#" onclick="logout()">Logout</a>
    </nav>

    <div id="dashboard" class="tabcontent">
        <h2>Dashboard</h2>
        <!-- Sample dashboard with linked metrics here -->
        <div><button onclick="showTab('customers')">Total Customers: <span id="totalCustomers">0</span></button></div>
        <div><button onclick="showTab('inspections')">Total Inspections: <span id="totalInspections">0</span></button></div>
        <div><button onclick="showTab('proposals')">Total Proposals: <span id="totalProposals">0</span></button></div>
        <div><button onclick="showTab('technicians')">Total Technicians: <span id="totalTechnicians">0</span></button></div>
    </div>

    <div id="customers" class="tabcontent hidden">
        <h2>Customers</h2>
        <!-- Customer form and list would go here -->
        <button class="button" onclick="addCustomer()">Add Customer</button>
        <table id="customerTable"><thead><tr><th>Name</th><th>City</th><th>State</th><th>Sites</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="inspections" class="tabcontent hidden">
        <h2>Inspections</h2>
        <button class="button" onclick="addInspection()">Add Inspection</button>
        <table id="inspectionTable"><thead><tr><th>Customer</th><th>Service Type</th><th>Technician</th><th>Completion Date</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="proposals" class="tabcontent hidden">
        <h2>Proposals</h2>
        <button class="button" onclick="addProposal()">Add Proposal</button>
        <table id="proposalTable"><thead><tr><th>Customer</th><th>Proposal Date</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="technicians" class="tabcontent hidden">
        <h2>Technicians</h2>
        <button class="button" onclick="addTechnician()">Add Technician</button>
        <table id="technicianTable"><thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Certification</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>

    <div id="reports" class="tabcontent hidden">
        <h2>Reports</h2>
        <!-- Reports content here -->
        <button class="button" onclick="exportCustomers()">Export Customers</button>
        <button class="button" onclick="exportInspections()">Export Inspections</button>
        <button class="button" onclick="exportProposals()">Export Proposals</button>
        <button class="button" onclick="exportTechnicians()">Export Technicians</button>
    </div>
</div>

<script>
    const STORAGE_KEY = 'inspectionCRM';
    let currentUser = null;
    let crmData = {
        users: [
            { email: 'andrew@infraredservices.net', password: 'A1234567a', role: 'Admin' }
        ],
        customers: [],
        inspections: [],
        proposals: [],
        technicians: []
    };

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(crmData));
    }

    function loadData() {
        const data = localStorage.getItem(STORAGE_KEY);
        if (data) {
            crmData = JSON.parse(data);
        }
    }

    function login() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const user = crmData.users.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
        const message = document.getElementById('loginMessage');
        if (user) {
            message.textContent = '';
            currentUser = user;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userRole').textContent = user.role;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('resetPasswordScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            showTab('dashboard');
            refreshAllTables();
        } else {
            message.textContent = 'Invalid email or password';
        }
    }

    function logout() {
        currentUser = null;
        document.getElementById('app').classList.add('hidden');
        document.getElementById('loginScreen').classList.remove('hidden');
        clearLoginInputs();
    }

    function clearLoginInputs() {
        document.getElementById('email').value = '';
        document.getElementById('password').value = '';
    }

    function showResetPassword() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('resetPasswordScreen').classList.remove('hidden');
        document.getElementById('resetMessage').textContent = '';
    }

    function showLogin() {
        document.getElementById('resetPasswordScreen').classList.add('hidden');
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('loginMessage').textContent = '';
    }

    function resetPassword() {
        const email = document.getElementById('resetEmail').value.trim();
        const user = crmData.users.find(u => u.email.toLowerCase() === email.toLowerCase());
        const resetMsg = document.getElementById('resetMessage');
        if (user) {
            // In real scenario, email reset link. Here, admin can reset password
            resetMsg.style.color = 'green';
            resetMsg.textContent = 'Password reset simulated: Please contact Admin to reset your password.';
        } else {
            resetMsg.style.color = 'red';
            resetMsg.textContent = 'Email not found';
        }
    }

    function showTab(tabName) {
        const tabs = document.querySelectorAll('.tabcontent');
        tabs.forEach(tab => {
            tab.classList.add('hidden');
        });
        const targetTab = document.getElementById(tabName);
        if (targetTab) {
            targetTab.classList.remove('hidden');
        }
    }

    // Add other functions for add/edit/delete customers, inspections, proposals, technicians...
    // For brevity, I'll simulate loading and refreshing counts on dashboard and listing

    function refreshAllTables() {
        // Update dashboard counts
        document.getElementById('totalCustomers').textContent = crmData.customers.length;
        document.getElementById('totalInspections').textContent = crmData.inspections.length;
        document.getElementById('totalProposals').textContent = crmData.proposals.length;
        document.getElementById('totalTechnicians').textContent = crmData.technicians.length;

        // For simplicity, no full table rendering here
    }

    // Initialization
    loadData();

    // Auto-login for initial user demo purposes
    // Automatically login the initial user
    // login(); // Uncomment this to auto login for demo

    // Save any changes
    window.addEventListener('beforeunload', saveData);
</script>

</body>
</html>
